var form_functions=function(){$(document).on("submit",".js_form",function(e){e.preventDefault();var t,a,i=$(this).prop("name");form_validation(i)&&(t={action:$(this).data("action"),formData:$(this).serializeArray()},a=hostname+"form_process.php",$.post(a,t,function(e){n(e)}))}),$(document).on("submit",".js_filter",function(e){e.preventDefault();var i=$("select[name=breed_filter]").val(),n=$("select[name=species_filter]").val(),s=$("select[name=year_filter]").val();$(".livestock_table").is(":visible")?$(".livestock_table").find("tr").each(function(e){$(this).show();var t=(t=$(this).find("td:nth-child(3)").text()).slice(0,4);"null"!=i&&$(this).find("td:nth-child(5)").text()!=i&&0<e&&$(this).hide(),"null"!=n&&$(this).find("td:nth-child(4)").text()!=n&&0<e&&$(this).hide(),"null"!=s&&t!=s&&0<e&&$(this).hide()}):$(".livestock_data .mobile_table").find("tbody").each(function(){$(this).show();var e=$(this).find("tr:nth-child(3) td").text().slice(3),t=$(this).find("tr:nth-child(5) td").text().slice(5),a=$(this).find("tr:nth-child(4) td").text().slice(7);"null"!=i&&t!=i&&$(this).hide(),"null"!=n&&a!=n&&$(this).hide(),"null"!=s&&e!=s&&$(this).hide()})}),$(document).on("click",".js_showForm",function(){var e="."+$(this).data("form");$(this).slideUp(300,function(){$(e).slideDown(500,function(){$("body").animate({scrollTop:$(e).offset().top},500)})})}),$(document).on("click",".js_edit",function(){$(".form_container").hide();var e=$(this).data("editid"),i="."+$(this).data("form"),t={id:e,table:$(this).data("table")},a=hostname+"data_get.php";$.post(a,t,function(e){var t=JSON.parse(e);for(var a in t){$(i+" [name="+a+"]").val(t[a])}switch(t.context){case"editBreed":$("select[name=species]").val(t.species)}$(".js_showForm").fadeOut(300,function(){$(i).slideDown(500,function(){$("body").animate({scrollTop:$(i).offset().top},500)})})})}),$(document).on("click",".js_edit_btn",function(){var e=$(this).data("editid"),c=$(this).data("edittype"),h="."+$(this).data("form"),t={id:e,table:c},a=hostname+"data_get.php";$.post(a,t,function(e){var t,a,i,n=JSON.parse(e);for(var s in n){"home_bred"==s||"for_slaughter"==s?(t=h+" [name="+s+"]",1==n[s]&&$(t).prop("checked",!0)):(t=h+" [name="+s+"]",$(t).val(n[s]))}if("livestock"===c&&(callClass({species:n.species,class_name:"getBreeds",return_action:"editLivestock_breedList"},n),callClass({species:n.species,class_name:"getMothersList",return_action:"editLivestock_motherList"},n),callClass({species:n.species,class_name:"getFathersList",return_action:"editLivestock_fatherList"},n)),"diary"===c){var o=n.livestock.split(","),r=n.medicine.split(","),d=n.manual_treatment.split(",");$("select[name=medicine]").val(r),$("select[name=manual_treatment]").val(d);for(var l=0;l<o.length;l++)$("#livestockSource").find('option[value="'+o[l]+'"]').clone().appendTo("#livestockSelected"),$("#livestockSource").find('option[value="'+o[l]+'"]').remove()}"reminder"===c&&(null!=n.remindMe_before&&(a=n.remindMe_before.split(","),$.each(a,function(e,t){"1 Month"===t&&$("#before_1m").prop("checked",!0),"1 Week"===t&&$("#before_1w").prop("checked",!0),"1 Day"===t&&$("#before_1d").prop("checked",!0)})),null!=n.remindMe_after&&(i=n.remindMe_after.split(","),$.each(i,function(e,t){"Monthly"===t&&$("#after_m").prop("checked",!0),"Weekly"===t&&$("#after_w").prop("checked",!0),"Daily"===t&&$("#after_d").prop("checked",!0)}))),$(".js_edit_btn").fadeOut(300,function(){$(h).slideDown(500),$("body").animate({scrollTop:$(h).offset().top},500)})})}),$(document).on("click",".js-delete",function(e){e.stopPropagation();var t=$(this).data("deletetype"),a=$(this).data("id");switch(t){case"species":$modal_content='<h2>Delete species</h2><p>Are you sure you want to delete this species?</p><p>Deleting is permanent and cannot be undone</p><form class="js_form" data-action="delete_species"><input type="hidden" name="id" value="'+a+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>';break;case"breed":$modal_content='<h2>Delete breed</h2><p>Are you sure you want to delete this breed?</p><p>Deleting is permanent and cannot be undone</p><form class="js_form" data-action="delete_breed"><input type="hidden" name="id" value="'+a+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>';break;case"livestock":$modal_content='<h2>Delete livestock</h2><p>Are you sure you want to delete this livestock?</p><p>Deleting is permanent and cannot be undone</p><form class="js_form" data-action="delete_livestock"><input type="hidden" name="id" value="'+a+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>';break;case"supplier":$modal_content='<h2>Delete supplier</h2><p>Are you sure you want to delete this supplier?</p><p>Deleting is permanent and cannot be undone</p><form class="js_form" data-action="delete_supplier"><input type="hidden" name="id" value="'+a+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>'}openModal($modal_content)}),$(document).on("click",".js-finish",function(e){e.preventDefault();var t=$(this).data("id"),a=$(this).data("type");"feed"==a?$modal_content='<h2>Mark feed as finished</h2><p>Are you sure you want to mark this feed as finished?</p><p>Finished date will be todays date.</p><p>To set another date, please edit the feed.</p><form class="js_form" data-action="finish_feed"><input type="hidden" name="id" value="'+t+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>':"medicine"==a&&($modal_content='<h2>Mark medicine as finished</h2><p>Are you sure you want to mark this medicine as finished?</p><p>Finished date will be todays date.</p><p>To set another date, please edit the medicine.</p><form class="js_form" data-action="finish_medicine"><input type="hidden" name="id" value="'+t+'" /><input type="submit" value="Confirm" class="form_btn" /></form><button class="js_closeModal btn_right" />Cancel</button>'),openModal($modal_content)});var n=function(e){var t=JSON.parse(e);switch(console.log(t),t.action){case"speciesAdded":var a="<tr><td class='left'>"+t.name+"</td><td>0</td><td>0</td><td>0</td><td></td><td></td></tr>";$(".species_table").append(a),$(".add_species").slideUp(500,function(){h("The new species has been added"),$("form")[0].reset(),$(".js_showForm").show()});break;case"speciesEdited":$(".edit_species").slideUp(),$(".js_edit_btn").show(),$("form")[0].reset(),h("Species edited"),callClass({id:t.id,class_name:"speciesEdited",return_action:"speciesEdited"},"");break;case"speciesDeleted":$('[data-id="'+t.id+'"]').remove(),h("Species deleted");break;case"breedAdded":a="<tr><td class='left'>"+t.name+"</td><td class='left'>"+t.species+"</td><td>0</td><td>0</td><td>0</td><td></td></tr>";$(".simple_breed_table").append(a),$(".add_breed").slideUp(500,function(){h("The new breed has been added"),$("form")[0].reset(),$(".js_showForm").show()});break;case"breedEdited":$(".edit_breed").slideUp(),$(".js_edit_btn").show(),$("form")[0].reset(),h("Breed edited"),callClass({id:t.id,class_name:"breedEdited",return_action:"breedEdited"},"");break;case"breedDeleted":$('[data-editid="'+t.id+'"]').remove(),h("Breed deleted");break;case"livestockFreeTextSearch":$(".search_results").html(t.html).slideDown(),applySorting();break;case"livestockFiltered":$(".livestock_data").empty().append(t.filter).append(t.html),applySorting();break;case"livestockAdded":var i=null==t.date_of_birth?"":t.date_of_birth,a="<tr class='edited'><td class='left'>"+t.uk_tag_no+"</td><td class='left'>"+t.livestock_name+"</td><td class='cen'>"+i+"</td><td class='left'>"+t.species+"</td><td class='left'>"+t.breed+"</td><td></td></tr>";$(".livestock_table").find("tr:first-child").after(a),$("form")[2].reset(),h("Livestock edited"),$(".add_livestock").slideUp(),$(".js_showForm").show(),setTimeout(function(){$(".edited").removeClass("edited")},7e3);break;case"livestockEdited":$(".edit_livestock").slideUp(),$(".js_edit_btn").show(),$("form")[0].reset(),h("Livestock edited"),callClass({id:t.id,class_name:"livestockEdited",return_action:"livestockEdited"},"");a='<tr><td class="left">'+t.supplier_name+'</td><td class="left">'+t.supplies+'</td><td class="left">'+t.telephone+'</td><td class="cen">'+t.email+'</td><td class="cen">'+t.website+"</td><td></td></tr>";break;case"livestockDeleted":window.location.replace(t.site_root+"/livestock?ld=true");break;case"supplierAdded":$(".add_supplier").slideUp(),$(".js_showForm").show(),$("form")[0].reset(),$(".suppliers_table").find("tr:first-child").after(a),h("Supplier added");break;case"supplierEdited":$(".edit_supplier").slideUp(),$(".js_edit_btn").show(),$("form")[0].reset(),h("Supplier edited"),callClass({id:t.id,class_name:"supplierEdited",return_action:"supplierEdited"},"");break;case"supplierDeleted":$('[data-id="'+t.id+'"]').remove(),h("Supplier deleted");break;case"feedAdded":$(".add_feed").slideUp(),$(".js_showForm").show(),$("form")[0].reset(),h("Feed added");var n=null!=t.purchase_date?t.purchase_date:"",s=null!=t.expiration_date?t.expiration_date:"",a="<tr><td>"+t.product_name+"</td><td>"+n+"</td><td>"+s+"</td><td>"+t.batch_number+"</td><td></td></tr>";$(".feed_table").find("tr:first-child").after(a);break;case"feedFinished":$('[data-id="'+t.id+'"]').remove(),h("Feed marked as finished");break;case"feedEdited":$(".edit_feed").slideUp(),$(".js_edit_btn").slideDown(),h("Feed edited"),callClass({id:t.id,class_name:"feedEdited",return_action:"feedEdited"},"");break;case"medicineAdded":$(".add_medicine").slideUp(),$(".js_showForm").show(),$("form")[0].reset(),h("Medicine added");var n=null!=t.purchase_date?t.purchase_date:"",o=null!=t.expiry_date?t.expiry_date:"",a="<tr><td>"+t.medicine_name+"</td><td>"+n+"</td><td>"+o+"</td><td>"+t.batch_number+"</td><td>"+t.description+"</td><td></td></tr>";$(".medicine_table").find("tr:first-child").after(a);break;case"medicineFinished":$('[data-id="'+t.id+'"]').remove(),h("Medicine marked as finished");break;case"medicineEdited":$(".edit_medicine").slideUp(),$(".js_edit_btn").slideDown(),h("Medicine edited"),callClass({id:t.id,class_name:"medicineEdited",return_action:"medicineEdited"},"");break;case"treatmentAdded":$(".add_manualTreatment").slideUp(),$(".js_showForm").show(),$("form")[0].reset();a="<tr><td class='left'>"+t.treatment_name+"</td><td class='left'>"+t.supplier+"</td><td>Â£"+t.price+"</td><td></td></tr>";$(".manualTreatment_table").find("tr:first-child").after(a),h("Manual treatment added");break;case"treatmentEdited":$(".edit_manualTreatment").slideUp(),$(".js_edit_btn").slideDown(),callClass({id:t.id,class_name:"manualTreatmentEdited",return_action:"manualTreatmentEdited"},""),h("Manual treatment edited");break;case"diaryAdded":$(".add_diary").slideUp(),$(".js_showForm").show(),$("form")[0].reset(),$("#livestockSelected option").each(function(){$(this).clone().appendTo("#livestockSource"),$(this).remove()}),u(),h("Diary entry added");break;case"diaryEdited":$(".edit_diary").slideUp(),$(".js_edit_btn").show(),$("#livestockSelected option").each(function(){$(this).clone().appendTo("#livestockSource"),$(this).remove()}),u(),$("form")[0].reset(),h("Diary entry edited"),callClass({id:t.id,class_name:"diaryEdited",return_action:"diaryEdited"},"");break;case"reminderAdded":$(".add_reminder").slideUp(),$(".js_showForm").show();var r="";switch(!0){case 3<t.priority:r="red";break;case 3==t.priority:r="amber";break;case 0<t.priority&&t.priority<3:r="green"}for(var d='<p class="priority '+r+'">',l=0;l<5;l++)l<t.priority?d+="<span>"+(l+1)+"</span>":d+='<span class="blank"></span>';var c='<h3>New</h3><table class="reminder_table"><tbody><tr><th>Due date</th><th width="100px">Priority</th><th>Description</th></tr><tr><td class="cen">'+t.reminder_date+'</td><td class="left">'+d+'</td><td class="left">'+t.description+"</td></table>";$(".card h2").after(c),$("form")[0].reset(),h("Reminder added")}},h=function(e){$("body").prepend('<div class="message">'+e+"</div>"),$("html, body").animate({scrollTop:0},500,function(){$(".message").animate({top:"0px"},500,function(){$(".message").delay(5e3).animate({top:"-200px"},1e3,function(){$(".message").remove()})})})};function u(){e("livestockSource"),e("livestockSelected")}function e(e){var t=document.getElementById(e);for(arrTexts=[],arrValues=[],arrOldTexts=[],i=0;i<t.length;i++)arrTexts[i]=t.options[i].text,arrValues[i]=t.options[i].value,arrOldTexts[i]=t.options[i].text;for(arrTexts.sort(function(e,t){var a=e[0].toLowerCase(),i=t[0].toLowerCase();return a<i?-1:i<a?1:0}),i=0;i<t.length;i++)for(t.options[i].text=arrTexts[i],j=0;j<t.length;j++)arrTexts[i]==arrOldTexts[j]&&(t.options[i].value=arrValues[j],j=t.length)}$(document).on("change",".js-filter select",function(){$(this).closest("form").submit()}),$(document).on("click",".js_clearFilters",function(){$(this).closest("form").find("select").val("null"),$(this).closest("form").submit()}),$(document).on("change",".add_livestock select[name=species], .edit_livestock select[name=species]",function(){$(this).val();callClass({species:$(this).val(),class_name:"getBreeds",return_action:"addLivestock_breedList"},""),callClass({species:$(this).val(),class_name:"getMothersList",return_action:"addLivestock_motherList"},""),callClass({species:$(this).val(),class_name:"getFathersList",return_action:"addLivestock_fatherList"},"")}),getUrlParameter("ld")&&h("Livestock deleted"),jQuery(document).on("click","#livestockSource",function(){var e=jQuery(this).find("option:selected"),t=e.clone();e.remove(),jQuery("#livestockSelected").append(t),u()}),jQuery(document).on("click","#livestockSelected",function(){var e=jQuery(this).find("option:selected"),t=e.clone();jQuery("#livestockSource").append(t).prop("selected",!0),e.remove(),u()}),jQuery(document).on("click",".addAll",function(){var e=jQuery("#livestockSource option").sort().clone();jQuery("#livestockSelected").append(e),jQuery("#livestockSource option").remove(),u()}),jQuery(document).on("click",".removeAll",function(){var e=jQuery("#livestockSelected option").sort().clone();jQuery("#livestockSource").append(e),jQuery("#livestockSelected option").remove(),u()}),jQuery(document).on("mousedown","form[name=add_diary] input[type=submit], form[name=edit_diary] input[type=submit]",function(){for(var e=jQuery("#livestockSelected option"),t=0;t<e.length;t++)e[t].selected=!0}),0!=$("#livestockSource").length&&u(),$(document).on("click",".js-unselect",function(){$(this).prev().val("")}),$(document).on("click",".js-clearDate",function(){$(this).prev().val("")})};$(document).ready(function(){hostname="http://"+window.location.hostname+"/redesign-flock-book/",applySorting(),form_functions(),pikaday(),general(),tables()});var general=function(){var e,a,t,n,s,o,i,r,d;$(".js_print").on("click",function(e){e.preventDefault(),window.print()}),$(document).on("click",function(){$(".mobileMenu").hasClass("open")&&($(".mobileMenu").animate({left:"-100%"}).removeClass("open"),$(".modalFade").hide())}),$(document).on("click",".menuTrigger",function(e){e.stopPropagation(),$(".mobileMenu").hasClass("open")?($(".mobileMenu").animate({left:"-100%"}).removeClass("open"),$(".modalFade").hide()):($(".modalFade").show(),$(".mobileMenu").animate({left:0}).addClass("open"))}),$(".modalFade, .modal::before, .js_closeModal").on("click",function(){closeModal()}),$(document).on("click",".js-top button",function(){$("body").animate({scrollTop:$("body").offset().top},500)}),$(document).on("click",".js-view",function(){var e=$(this).data("path"),t=$(this).data("id"),a=e?e+"/livestock?id="+t:"?id="+t;window.location.href=a}),$(document).on("click",".js-quickView",function(e){e.stopPropagation();var t={id:$(this).data("id"),table:"quickView"},a=hostname+"data_get.php";$.post(a,t,function(e){openModal("<h2>Quick view</h2>"+e)})}),$(document).on("click",".js-diaryQuickView",function(e){e.stopPropagation();var t={id:$(this).data("id"),table:"diaryQuickView"},a=hostname+"data_get.php";$.post(a,t,function(e){openModal("<h2>Quick view</h2>"+e)})}),$(document).on("click",".tableLink",function(e){e.stopPropagation()}),0!==$(".family_tree").length&&($(".family_tree").html("'f a m i l y  t r e e'"),e=hostname+"data_get.php",a=$(".family_tree").data("id"),$.post(e,{id:123,table:"familyTree"},function(e){var t=createSheepHTML(e=$.parseJSON(e),a);$(".family_tree").html("<ul>"+t+"</ul>")})),0!=$(".livestockFiltered").length&&(t=$(".livestockFiltered"),n=[],s=[],o=[],d=r=i="",t.find("tr").each(function(e){var t,a,i;0<e&&(t=$(this).find("td:nth-child(4)").text(),a=$(this).find("td:nth-child(5)").text(),i=$(this).find("td:nth-child(3)").text().slice(0,4),-1==n.indexOf(t)&&n.push(t),-1==s.indexOf(a)&&s.push(a),-1==o.indexOf(i)&&o.push(i))}),$.each(n,function(e,t){i+='<option value="'+t+'">'+t+"</option>"}),$.each(s,function(e,t){r+='<option value="'+t+'">'+t+"</option>"}),o.sort().reverse(),$.each(o,function(e,t){d+='<option value="'+t+'">'+t+"</option>"}),$("select[name=species_filter]").append(i),$("select[name=breed_filter]").append(r),$("select[name=year_filter]").append(d)),$(document).on("click",".accordion_title",function(){var e=$(this).closest(".accordion");e.hasClass("open")?e.removeClass("open"):($(".accordion").not($(this)).each(function(){$(this).removeClass("open")}),e.addClass("open"))})},applySorting=function(){var o,a;$("table").hasClass("sortable")&&($("table th").addClass("sortThis"),$("table th.no_sort").removeClass("sortThis"),o=function(e,t){return e.children[t].innerText||e.children[t].textContent},a=function(n,s){return function(e,t){return a=o(s?e:t,n),i=o(s?t:e,n),""===a||""===i||isNaN(a)||isNaN(i)?a.toString().localeCompare(i):a-i;var a,i}},Array.prototype.slice.call(document.querySelectorAll("th.sortThis")).forEach(function(e){e.addEventListener("click",function(){for(var t=e.parentNode;"TABLE"!=t.tagName.toUpperCase();)t=t.parentNode;Array.prototype.slice.call(t.querySelectorAll("tr:nth-child(n+2)")).sort(a(Array.prototype.slice.call(e.parentNode.children).indexOf(e),this.asc=!this.asc)).forEach(function(e){t.appendChild(e)})})}))},openModal=function(e){$("body").addClass("no_scroll"),$(".modal").empty().append(e),$(".modalFade").fadeIn(400,function(){$(".modal").fadeIn(300)})},closeModal=function(){$(".modal").fadeOut(200,function(){$(".modalFade").fadeOut(100),$("body").removeClass("no_scroll")})};function createSheepHTML(e,t){var a,i,n=getSheep(e,t);if(n)return i=1==n.gender?"ram":"ewe",deadAlive=null==n.date_of_death?"alive":"dead",a="<li>",a+="<div class='"+i+" js-view' data-id='"+n.id+"'>",a+="<span class='status "+deadAlive+"'></span>",a+="<span><p>"+n.livestock_name+"</p><p>"+n.uk_tag_no+"</p></span>",a+="<a class='icon icon_quickView js-quickView' data-id='"+n.id+"'></a>",a+="</div>",(n.mother||n.father)&&(a+="<ul>",n.mother&&(a+=createSheepHTML(e,n.mother)),n.father&&(a+=createSheepHTML(e,n.father)),a+="</ul>"),a+="</li>"}function getSheep(e,t){for(var a=0;a<e.length;a++)e[a].id==t&&(sheep=e[a]);return sheep}function callClass(e,t){var a=hostname+"call_class.php";$.post(a,e,function(e){processClassCall(e,t)})}function processClassCall(e,t){var a=JSON.parse(e);a.returnAction;switch(a.returnAction){case"addLivestock_breedList":$("select[name=breed]").empty().html(a.html).attr("disabled",!1);break;case"addLivestock_motherList":$("select[name=mother]").empty().html(a.html).attr("disabled",!1);break;case"addLivestock_fatherList":$("select[name=father]").empty().html(a.html).attr("disabled",!1);break;case"editLivestock_breedList":$("select[name=breed]").empty().html(a.html).val(t.breed);break;case"editLivestock_motherList":var i="0"!=t.mother?t.mother:"null";$("select[name=mother]").empty().html(a.html).val(i);break;case"editLivestock_fatherList":var n="0"!=t.father?t.father:"null";$("select[name=father]").empty().html(a.html).val(n);break;case"speciesEdited":$(".controls, .speciesCard").remove(),$("content").prepend(a.html);break;case"breedEdited":$(".controls, .breedCard").remove(),$("content").prepend(a.html);break;case"livestockEdited":$(".controls, .animalCard").remove(),$("content").prepend(a.html);break;case"supplierEdited":$(".controls, .supplierCard").remove(),$("content").prepend(a.html);break;case"feedEdited":$(".controls, .feedCard").remove(),$("content").prepend(a.html);break;case"medicineEdited":$(".controls, .medicineCard").remove(),$("content").prepend(a.html);break;case"treatmentEdited":$(".controls, .manualTreatmentCard").remove(),$("content").prepend(a.html);break;case"diaryEdited":$(".controls, .diaryCardSingle").remove(),$("content").prepend(a.html)}}var getUrlParameter=function(e){for(var t,a=window.location.search.substring(1).split("&"),i=0;i<a.length;i++)if((t=a[i].split("="))[0]===e)return t[1],decodeURIComponent(t[1]);return!1},pikaday=function(){!function(e,t){"use strict";var a;if("object"==typeof exports){try{a=require("moment")}catch(e){}module.exports=t(a)}else"function"==typeof define&&define.amd?define(function(e){try{a=e("moment")}catch(e){}return t(a)}):e.Pikaday=t(e.moment)}(this,function(Y){"use strict";function s(e,t,a,i){r?e.addEventListener(t,a,!!i):e.attachEvent("on"+t,a)}function t(e,t,a,i){r?e.removeEventListener(t,a,!!i):e.detachEvent("on"+t,a)}function o(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function u(e,t){o(e,t)||(e.className=""===e.className?t:e.className+" "+t)}function p(e,t){var a;e.className=(a=(" "+e.className+" ").replace(" "+t+" "," ")).trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function v(e){return/Array/.test(Object.prototype.toString.call(e))}function W(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())}function U(e,t){return[31,(a=e)%4==0&&a%100!=0||a%400==0?29:28,31,30,31,30,31,31,30,31,30,31][t];var a}function P(e){W(e)&&e.setHours(0,0,0,0)}function Q(e,t){return e.getTime()===t.getTime()}function n(e,t,a){var i;m.createEvent?((i=m.createEvent("HTMLEvents")).initEvent(t,!0,!1),i=d(i,a),e.dispatchEvent(i)):m.createEventObject&&(i=m.createEventObject(),i=d(i,a),e.fireEvent("on"+t,i))}function a(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),11<e.month&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e}function i(e,t,a){for(t+=e.firstDay;7<=t;)t-=7;return a?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]}function V(e,t){function a(e){return(e+7-1)%7}e.setHours(0,0,0,0);var i=e.getDate(),n=e.getDay(),s=t,o=s-1;e.setDate(i+o-a(n));var r=new Date(e.getFullYear(),0,s),d=(e.getTime()-r.getTime())/864e5;return 1+Math.round((d-o+a(r.getDay()))/7)}function B(e,t,a){return'<table cellpadding="0" cellspacing="0" class="pika-table" role="grid" aria-labelledby="'+a+'">'+function(e){var t,a=[];for(e.showWeekNumber&&a.push("<th></th>"),t=0;t<7;t++)a.push('<th scope="col"><abbr title="'+i(e,t)+'">'+i(e,t,!0)+"</abbr></th>");return"<thead><tr>"+(e.isRTL?a.reverse():a).join("")+"</tr></thead>"}(e)+"<tbody>"+t.join("")+"</tbody></table>"}function e(e){var i=this,n=i.config(e);i._onMouseDown=function(e){if(i._v){var t=(e=e||window.event).target||e.srcElement;if(t)if(o(t,"is-disabled")||(!o(t,"pika-button")||o(t,"is-empty")||o(t.parentNode,"is-disabled")?o(t,"pika-prev")?i.prevMonth():o(t,"pika-next")&&i.nextMonth():(i.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),n.bound&&l(function(){i.hide(),n.blurFieldOnSelect&&n.field&&n.field.blur()},100))),o(t,"pika-select"))i._c=!0;else{if(!e.preventDefault)return e.returnValue=!1;e.preventDefault()}}},i._onChange=function(e){var t=(e=e||window.event).target||e.srcElement;t&&(o(t,"pika-select-month")?i.gotoMonth(t.value):o(t,"pika-select-year")&&i.gotoYear(t.value))},i._onKeyChange=function(e){if(e=e||window.event,i.isVisible())switch(e.keyCode){case 13:case 27:n.field&&n.field.blur();break;case 37:i.adjustDate("subtract",1);break;case 38:i.adjustDate("subtract",7);break;case 39:i.adjustDate("add",1);break;case 40:i.adjustDate("add",7);break;case 8:case 46:i.setDate(null)}},i._parseFieldValue=function(){if(n.parse)return n.parse(n.field.value,n.format);if(H){var e=Y(n.field.value,n.format,n.formatStrict);return e&&e.isValid()?e.toDate():null}return new Date(Date.parse(n.field.value))},i._onInputChange=function(e){var t;e.firedBy!==i&&(t=i._parseFieldValue(),W(t)&&i.setDate(t),i._v||i.show())},i._onInputFocus=function(){i.show()},i._onInputClick=function(){i.show()},i._onInputBlur=function(){var e=m.activeElement;do{if(o(e,"pika-single"))return}while(e=e.parentNode);i._c||(i._b=l(function(){i.hide()},50)),i._c=!1},i._onClick=function(e){var t=(e=e||window.event).target||e.srcElement,a=t;if(t){!r&&o(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),s(t,"change",i._onChange)));do{if(o(a,"pika-single")||a===n.trigger)return}while(a=a.parentNode);i._v&&t!==n.trigger&&a!==n.trigger&&i.hide()}},i.el=m.createElement("div"),i.el.className="pika-single"+(n.isRTL?" is-rtl":"")+(n.theme?" "+n.theme:""),s(i.el,"mousedown",i._onMouseDown,!0),s(i.el,"touchend",i._onMouseDown,!0),s(i.el,"change",i._onChange),n.keyboardInput&&s(m,"keydown",i._onKeyChange),n.field&&(n.container?n.container.appendChild(i.el):n.bound?m.body.appendChild(i.el):n.field.parentNode.insertBefore(i.el,n.field.nextSibling),s(n.field,"change",i._onInputChange),n.defaultDate||(n.defaultDate=i._parseFieldValue(),n.setDefaultDate=!0));var t=n.defaultDate;W(t)?n.setDefaultDate?i.setDate(t,!0):i.gotoDate(t):i.gotoDate(new Date),n.bound?(this.hide(),i.el.className+=" is-bound",s(n.trigger,"click",i._onInputClick),s(n.trigger,"focus",i._onInputFocus),s(n.trigger,"blur",i._onInputBlur)):this.show()}var H="function"==typeof Y,r=!!window.addEventListener,m=window.document,l=window.setTimeout,d=function(e,t,a){var i,n;for(i in t)(n=void 0!==e[i])&&"object"==typeof t[i]&&null!==t[i]&&void 0===t[i].nodeName?W(t[i])?a&&(e[i]=new Date(t[i].getTime())):v(t[i])?a&&(e[i]=t[i].slice(0)):e[i]=d({},t[i],a):!a&&n||(e[i]=t[i]);return e},c={field:null,bound:void 0,ariaLabel:"Use the arrow keys to pick a date",position:"bottom left",reposition:!0,format:"YYYY-MM-DD",toString:null,parse:null,defaultDate:null,setDefaultDate:!1,firstDay:0,firstWeekOfYearMinDays:4,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,pickWholeWeek:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,enableSelectionDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,blurFieldOnSelect:!0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,events:[],onSelect:null,onOpen:null,onClose:null,onDraw:null,keyboardInput:!0};return e.prototype={config:function(e){this._o||(this._o=d({},c,!0));var t=d(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var a,i=parseInt(t.numberOfMonths,10)||1;return t.numberOfMonths=4<i?4:i,W(t.minDate)||(t.minDate=!1),W(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),v(t.yearRange)?(a=(new Date).getFullYear()-10,t.yearRange[0]=parseInt(t.yearRange[0],10)||a,t.yearRange[1]=parseInt(t.yearRange[1],10)||a):(t.yearRange=Math.abs(parseInt(t.yearRange,10))||c.yearRange,100<t.yearRange&&(t.yearRange=100)),t},toString:function(e){return e=e||this._o.format,W(this._d)?this._o.toString?this._o.toString(this._d,e):H?Y(this._d).format(e):this._d.toDateString():""},getMoment:function(){return H?Y(this._d):null},setMoment:function(e,t){H&&Y.isMoment(e)&&this.setDate(e.toDate(),t)},getDate:function(){return W(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",n(this._o.field,"change",{firedBy:this})),this.draw();var a,i;"string"==typeof e&&(e=new Date(Date.parse(e))),W(e)&&(a=this._o.minDate,i=this._o.maxDate,W(a)&&e<a?e=a:W(i)&&i<e&&(e=i),this._d=new Date(e.getTime()),P(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),n(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate()))},clear:function(){this.setDate(null)},gotoDate:function(e){var t,a,i,n=!0;W(e)&&(this.calendars&&(t=new Date(this.calendars[0].year,this.calendars[0].month,1),a=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),i=e.getTime(),a.setMonth(a.getMonth()+1),a.setDate(a.getDate()-1),n=i<t.getTime()||a.getTime()<i),n&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars())},adjustDate:function(e,t){var a,i=this.getDate()||new Date,n=24*parseInt(t)*60*60*1e3;"add"===e?a=new Date(i.valueOf()+n):"subtract"===e&&(a=new Date(i.valueOf()-n)),this.setDate(a)},adjustCalendars:function(){this.calendars[0]=a(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=a({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){e instanceof Date?(P(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()):(this._o.minDate=c.minDate,this._o.minYear=c.minYear,this._o.minMonth=c.minMonth,this._o.startRange=c.startRange),this.draw()},setMaxDate:function(e){e instanceof Date?(P(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth()):(this._o.maxDate=c.maxDate,this._o.maxYear=c.maxYear,this._o.maxMonth=c.maxMonth,this._o.endRange=c.endRange),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t,a=this._o,i=a.minYear,n=a.maxYear,s=a.minMonth,o=a.maxMonth,r="";this._y<=i&&(this._y=i,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=n&&(this._y=n,!isNaN(o)&&this._m>o&&(this._m=o));for(var d=0;d<a.numberOfMonths;d++)t="pika-title-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,2),r+='<div class="pika-lendar">'+function(e,t,a,i,n,s){for(var o,r,d,l=e._o,c=a===l.minYear,h=a===l.maxYear,u='<div id="'+s+'" class="pika-title" role="heading" aria-live="assertive">',p=!0,m=!0,f=[],_=0;_<12;_++)f.push('<option value="'+(a===n?_-t:12+_-t)+'"'+(_===i?' selected="selected"':"")+(c&&_<l.minMonth||h&&_>l.maxMonth?' disabled="disabled"':"")+">"+l.i18n.months[_]+"</option>");for(r='<div class="pika-label">'+l.i18n.months[i]+'<select class="pika-select pika-select-month" tabindex="-1">'+f.join("")+"</select></div>",o=v(l.yearRange)?(_=l.yearRange[0],l.yearRange[1]+1):(_=a-l.yearRange,1+a+l.yearRange),f=[];_<o&&_<=l.maxYear;_++)_>=l.minYear&&f.push('<option value="'+_+'"'+(_===a?' selected="selected"':"")+">"+_+"</option>");return d='<div class="pika-label">'+a+l.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+f.join("")+"</select></div>",l.showMonthAfterYear?u+=d+r:u+=r+d,c&&(0===i||l.minMonth>=i)&&(p=!1),h&&(11===i||l.maxMonth<=i)&&(m=!1),0===t&&(u+='<button class="pika-prev'+(p?"":" is-disabled")+'" type="button">'+l.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(u+='<button class="pika-next'+(m?"":" is-disabled")+'" type="button">'+l.i18n.nextMonth+"</button>"),u+"</div>"}(this,d,this.calendars[d].year,this.calendars[d].month,this.calendars[0].year,t)+this.render(this.calendars[d].year,this.calendars[d].month,t)+"</div>";this.el.innerHTML=r,a.bound&&"hidden"!==a.field.type&&l(function(){a.trigger.focus()},1),"function"==typeof this._o.onDraw&&this._o.onDraw(this),a.bound&&a.field.setAttribute("aria-label",a.ariaLabel)}},adjustPosition:function(){var e,t,a,i,n,s,o,r,d,l,c,h;if(!this._o.container){if(this.el.style.position="absolute",t=e=this._o.trigger,a=this.el.offsetWidth,i=this.el.offsetHeight,n=window.innerWidth||m.documentElement.clientWidth,s=window.innerHeight||m.documentElement.clientHeight,o=window.pageYOffset||m.body.scrollTop||m.documentElement.scrollTop,h=c=!0,"function"==typeof e.getBoundingClientRect)r=(l=e.getBoundingClientRect()).left+window.pageXOffset,d=l.bottom+window.pageYOffset;else for(r=t.offsetLeft,d=t.offsetTop+t.offsetHeight;t=t.offsetParent;)r+=t.offsetLeft,d+=t.offsetTop;(this._o.reposition&&n<r+a||-1<this._o.position.indexOf("right")&&0<r-a+e.offsetWidth)&&(r=r-a+e.offsetWidth,c=!1),(this._o.reposition&&s+o<d+i||-1<this._o.position.indexOf("top")&&0<d-i-e.offsetHeight)&&(d=d-i-e.offsetHeight,h=!1),r<0&&(r=0),d<0&&(d=0),this.el.style.left=r+"px",this.el.style.top=d+"px",u(this.el,c?"left-aligned":"right-aligned"),u(this.el,h?"bottom-aligned":"top-aligned"),p(this.el,c?"right-aligned":"left-aligned"),p(this.el,h?"top-aligned":"bottom-aligned")}},render:function(e,t,a){var i=this._o,n=new Date,s=U(e,t),o=new Date(e,t,1).getDay(),r=[],d=[];P(n),0<i.firstDay&&(o-=i.firstDay)<0&&(o+=7);for(var l=0===t?11:t-1,c=11===t?0:t+1,h=0===t?e-1:e,u=11===t?e+1:e,p=U(h,l),m=s+o,f=m;7<f;)f-=7;m+=7-f;for(var _,v,b,$,y,g,k,w,D=!1,M=0,j=0;M<m;M++){var C=new Date(e,t,M-o+1),x=!!W(this._d)&&Q(C,this._d),S=Q(C,n),T=-1!==i.events.indexOf(C.toDateString()),E=M<o||s+o<=M,N=M-o+1,L=t,F=e,R=i.startRange&&Q(i.startRange,C),A=i.endRange&&Q(i.endRange,C),O=i.startRange&&i.endRange&&i.startRange<C&&C<i.endRange;E&&(F=M<o?(N=p+N,L=l,h):(N-=s,L=c,u));var I={day:N,month:L,year:F,hasEvent:T,isSelected:x,isToday:S,isDisabled:i.minDate&&C<i.minDate||i.maxDate&&C>i.maxDate||i.disableWeekends&&(w=void 0,0===(w=C.getDay())||6===w)||i.disableDayFn&&i.disableDayFn(C),isEmpty:E,isStartRange:R,isEndRange:A,isInRange:O,showDaysInNextAndPreviousMonths:i.showDaysInNextAndPreviousMonths,enableSelectionDaysInNextAndPreviousMonths:i.enableSelectionDaysInNextAndPreviousMonths};i.pickWholeWeek&&x&&(D=!0),d.push(function(e){var t=[],a="false";if(e.isEmpty){if(!e.showDaysInNextAndPreviousMonths)return'<td class="is-empty"></td>';t.push("is-outside-current-month"),e.enableSelectionDaysInNextAndPreviousMonths||t.push("is-selection-disabled")}return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&(t.push("is-selected"),a="true"),e.hasEvent&&t.push("has-event"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'" aria-selected="'+a+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"}(I)),7==++j&&(i.showWeekNumber&&d.unshift((b=M-o,$=t,y=e,g=i.firstWeekOfYearMinDays,k=void 0,k=new Date(y,$,b),'<td class="pika-week">'+(H?Y(k).isoWeek():V(k,g))+"</td>")),r.push((_=d,v=i.isRTL,'<tr class="pika-row'+(i.pickWholeWeek?" pick-whole-week":"")+(D?" is-selected":"")+'">'+(v?_.reverse():_).join("")+"</tr>")),j=0,D=!(d=[]))}return B(i,r,a)},isVisible:function(){return this._v},show:function(){this.isVisible()||(this._v=!0,this.draw(),p(this.el,"is-hidden"),this._o.bound&&(s(m,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;!1!==e&&(this._o.bound&&t(m,"click",this._onClick),this._o.container||(this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto"),u(this.el,"is-hidden"),this._v=!1,void 0!==e&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){var e=this._o;this.hide(),t(this.el,"mousedown",this._onMouseDown,!0),t(this.el,"touchend",this._onMouseDown,!0),t(this.el,"change",this._onChange),e.keyboardInput&&t(m,"keydown",this._onKeyChange),e.field&&(t(e.field,"change",this._onInputChange),e.bound&&(t(e.trigger,"click",this._onInputClick),t(e.trigger,"focus",this._onInputFocus),t(e.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},e})},tables=function(){$(document).find("table").each(function(){var e='<table class="mobile_table">',n=[],s="";$(this).find("tr").each(function(e){var t,a,i;0==e?$(this).find("th").each(function(){n.push($(this).text())}):(t=$(this).data("id")?' data-id="'+$(this).data("id")+'" ':' data-editid="'+$(this).data("editid")+'" ',a="edit_breed"==$(this).data("form")?"breed":"species",i=$(this).hasClass("js-view")?' class="js-view" ':' data-form="edit_'+a+'" data-table="'+a+'" class="js_edit" ',s+="<tbody>",$(this).find("td").each(function(e){s+="<tr"+i+t+"><td><span>"+n[e]+"</span>"+$(this).html()+"</td></tr>"}),s+="</tbody>")}),e+=s+"</table>",$(this).after(e)})},form_validation=function(e){var i=!0;return $(".error_message").remove(),$(".error").removeClass("error"),$('form[name="'+e+'"] input, form[name="'+e+'"] select, form[name="'+e+'"] textarea').each(function(){var e=$(this).data("validation"),a=$(this);void 0!==e&&(e=e.split(","),value=a.val(),e.forEach(function(e,t){"required"!==e||""!=value&&"null"!=value||(i=!1,a.addClass("error").after('<span class="error_message">'+a.data("errormessage")+"</span>")),"number"!==e||!isNaN(value)&&""!=value||(i=!1,a.addClass("error").after('<span class="error_message">Please enter only numbers</span>'))}))}),i};